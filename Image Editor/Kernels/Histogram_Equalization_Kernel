__kernel void calculate_histogram(__global const int * data, __global int * result,
__global int * dimensions){

int RED_MASK = 0x00ff0000;
int RED_OFFSET = 16;

int i = (get_group_id(0) * get_local_size(0)) + get_local_id(0);

int numBins = dimensions[0];

result[i] = 0;

barrier(CLK_LOCAL_MEM_FENCE);

int pixel = data[i];

int currentValue = (pixel & RED_MASK) >> RED_OFFSET;
//Does this need &?
atomic_add(&result[pixel], 1);
}




__kernel void cumulative_frequency_distribution(__global const int * bins, __global int * distribution,
__global int * dimensions){
int i = (get_group_id(0) * get_local_size(0)) + get_local_id(0);

int numBins = dimensions[0];

for(int j = i; j >= 0; j--){
	atomic_add(distribution[i], bins[j]);
}


}


__kernel void idealize_histogram(__global const int * histogram, __global int * ideal,
__global int * dimension){
int i = (get_group_id(0) * get_local_size(0)) + get_local_id(0);

int numBins = dimensions[0];
int pixelCount = dimensions[1];

int avg = pixelCount / numBins;
int leftOver = pixelCount - (avg * numBins);
int mid = (numBins - 1) / 2;
int extraStart = mid - (leftOver / 2);
int extraEnd = extraStart + leftOver;

if (i >= extraStart && i < extraEnd) {
	ideal[i] = avg + 1;
} 
else {
	ideal[i] = avg;
}
}






